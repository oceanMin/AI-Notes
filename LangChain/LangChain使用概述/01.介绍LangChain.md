å¥½çš„ï¼Œå°å¤©æ¥å¸®ä½ æŠŠè¿™ä»½ã€ŠLangChainä½¿ç”¨æ¦‚è¿°ã€‹çš„è¯¾ç¨‹ç¬”è®°æ•´ç†æˆæ¸…æ™°ã€ç¾è§‚çš„ Markdown æ ¼å¼æ–‡æ¡£ã€‚

ğŸ“˜ LangChainä½¿ç”¨æ¦‚è¿°

1. ä»‹ç» LangChain
1.1 ä»€ä¹ˆæ˜¯ LangChain

å®šä¹‰ï¼šLangChain æ˜¯ä¸€ä¸ªäº 2022å¹´10æœˆ ç”±å“ˆä½›å¤§å­¦çš„ Harrison Chaseï¼ˆå“ˆé‡Œæ£®Â·è”¡æ–¯ï¼‰å‘èµ·çš„å¼€æºæ¡†æ¶ï¼Œç”¨äºå¼€å‘ç”±å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMsï¼‰é©±åŠ¨çš„åº”ç”¨ç¨‹åºã€‚
åº”ç”¨æ–¹å‘ï¼šå¯æ„å»ºâ€œæ™ºèƒ½ä½“â€ï¼ˆAgentï¼‰ã€é—®ç­”ç³»ç»Ÿï¼ˆQAï¼‰ã€å¯¹è¯æœºå™¨äººã€æ–‡æ¡£æœç´¢ç³»ç»Ÿã€ä¼ä¸šç§æœ‰çŸ¥è¯†åº“ç­‰ã€‚
æ ¸å¿ƒæ¯”å–»ï¼š

LangChain ä¹‹äº LLMsï¼Œå¦‚åŒ Spring ä¹‹äº Javaã€‚
LangChain ä¹‹äº LLMsï¼Œå¦‚åŒ Djangoã€Flask ä¹‹äº Pythonã€‚


å‘½åè§£æï¼š

Langï¼šLanguageï¼ŒæŒ‡å¤§è¯­è¨€æ¨¡å‹ã€‚
Chainï¼šé“¾ï¼Œå³å°†å¤§æ¨¡å‹ä¸å¤–éƒ¨æ•°æ®ã€å„ç§ç»„ä»¶è¿æ¥æˆé“¾ï¼Œæ„å»ºAIåº”ç”¨ã€‚


æ ¸å¿ƒç†å¿µï¼šåº”ç”¨ä¸ºç‹ï¼ å­¦ä¹  LangChain æ˜¯é«˜æ•ˆå¼€å‘å¤§æ¨¡å‹åº”ç”¨çš„å…³é”®ã€‚

1.2 æœ‰å“ªäº›å¤§æ¨¡å‹åº”ç”¨å¼€å‘æ¡†æ¶ï¼Ÿ
æˆªè‡³2025å¹´7æœˆ26æ—¥ï¼Œä¸»æµæ¡†æ¶å¦‚ä¸‹ï¼š



æ¡†æ¶
ç‰¹ç‚¹




LangChain
å‡ºç°æœ€æ—©ã€æœ€æˆç†Ÿï¼Œé€‚åˆå¤æ‚ä»»åŠ¡åˆ†è§£å’Œå•æ™ºèƒ½ä½“åº”ç”¨ã€‚


LlamaIndex
ä¸“æ³¨äºé«˜æ•ˆçš„ç´¢å¼•å’Œæ£€ç´¢ï¼Œéå¸¸é€‚åˆ RAG åœºæ™¯ã€‚ï¼ˆæ³¨æ„ï¼šä¸æ˜¯ Meta å¼€å‘çš„ï¼‰


LangChain4J
LangChain çš„ Java ç‰ˆæœ¬ï¼Œæ ¸å¿ƒåŠŸèƒ½é½å…¨ï¼Œä½†åŠŸèƒ½ç•¥å°‘ã€‚


Spring AI / Spring AI Alibaba
æœ‰å¾…è¿›ä¸€æ­¥æˆç†Ÿï¼Œç›®å‰ä¸»è¦æ˜¯å¯¹ä¸€äº›æ¥å£è¿›è¡Œäº†å°è£…ã€‚


SemanticKernel (SK)
å¾®è½¯æ¨å‡ºï¼Œå¯¹ C# å¼€å‘è€…éå¸¸å‹å¥½ã€‚



1.3 ä¸ºä»€ä¹ˆéœ€è¦ LangChainï¼Ÿ
é—®é¢˜1ï¼šLLMs ç”¨å¾—å¥½å¥½çš„ï¼Œä¸ºä½•è¿˜éœ€è¦ LangChainï¼Ÿ

LLMsï¼ˆå¦‚ ChatGPT, Claudeï¼‰æœ¬èº«åŠŸèƒ½å¼ºå¤§ï¼Œä½† LangChain èƒ½å°†å®ƒä»¬çµæ´»é›†æˆåˆ°è‡ªæœ‰åº”ç”¨ä¸­ï¼Œå®ç°æ›´é«˜çº§çš„åŠŸèƒ½ï¼Œå¦‚ï¼š

è”ç½‘æœç´¢
æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰
å·¥å…·è°ƒç”¨ï¼ˆTool Callingï¼‰
å¤šè½®å¤æ‚æ¨ç†



é—®é¢˜2ï¼šå¯ä»¥ç›´æ¥ç”¨ GPT/GLM4 çš„ APIï¼Œä¸ºä½•è¿˜è¦ LangChainï¼Ÿ



æ–¹å¼
ä¼˜åŠ¿
åŠ£åŠ¿




ç›´æ¥è°ƒç”¨ API
æ§åˆ¶ç²’åº¦æ›´ç»†
å¼€å‘éš¾åº¦é«˜ã€å­¦ä¹ æˆæœ¬é«˜ï¼ˆä¸åŒæ¨¡å‹APIå„å¼‚ï¼‰ã€ç§»æ¤æ€§å·®


ä½¿ç”¨ LangChain
ç®€åŒ–å¼€å‘ã€é™ä½å­¦ä¹ æˆæœ¬ã€ç»Ÿä¸€è°ƒç”¨æ–¹å¼ã€ç§»æ¤æ€§å¥½
-




æ ¸å¿ƒä»·å€¼ï¼šæä¾›ç°æˆçš„é“¾å¼ç»„è£…ï¼Œè®©å¤æ‚é€»è¾‘å˜å¾—ç»“æ„åŒ–ã€æ˜“ç»„åˆã€æ˜“æ‰©å±•ã€‚

é—®é¢˜3ï¼šLangChain æä¾›äº†å“ªäº›åŠŸèƒ½ï¼Ÿ
LangChain æ˜¯ä¸€ä¸ªå…¨å¥—å·¥å…·é›†ï¼Œæ¶µç›–äº†æ„å»º LLM åº”ç”¨çš„å„ä¸ªæ–¹é¢ï¼š

âœ… Prompt æ„å»º
âœ… LLM æ¥å…¥
âœ… è®°å¿†ç®¡ç†
âœ… å·¥å…·è°ƒç”¨
âœ… æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰
âœ… æ™ºèƒ½ä½“ï¼ˆAgentï¼‰å¼€å‘


ğŸ’¡ æœ€ä½³å­¦ä¹ æ–¹å¼ï¼šé€šè¿‡åšé¡¹ç›®æ¥å­¦ä¹ ï¼

1.4 LangChain çš„ä½¿ç”¨åœºæ™¯
å­¦å®Œ LangChainï¼Œä½ å¯ä»¥å®ç°ä»¥ä¸‹ç±»å‹çš„é¡¹ç›®ï¼š

åŒ»é™¢æ™ºèƒ½åŠ©æ‰‹
ä¸‡è±¡çŸ¥è¯†åº“
äº¬ä¸œåŠ©æ‰‹
ä¼ä¸šçŸ¥è¯†åº“åŠ©æ‰‹ï¼ˆRAG + æœ¬åœ°æ¨¡å‹ï¼‰

1.5 LangChain èµ„æ–™ä»‹ç»

å®˜ç½‘ï¼šhttps://www.langchain.com/langchain
å®˜æ–¹æ–‡æ¡£ï¼šhttps://python.langchain.com/docs/introduction/
API æ–‡æ¡£ï¼šhttps://python.langchain.com/api_reference/
GitHubï¼šhttps://github.com/langchain-ai/langchain

1.6 æ¶æ„è®¾è®¡
1.6.1 æ€»ä½“æ¶æ„å›¾
LangChain ç”Ÿæ€ç³»ç»Ÿä¸»è¦åˆ†ä¸ºä¸‰ä¸ªå±‚æ¬¡ï¼š

æ¶æ„ (Architecture)
ç»„ä»¶ (Components)
éƒ¨ç½² (Deployment)


ğŸ” ç‰ˆæœ¬è¿­ä»£ï¼šv0.2 / v0.3 ç›¸è¾ƒäº v0.1ï¼Œä¿®æ”¹äº†çº¦ 10%-15%ï¼Œä¸»è¦æå‡ç¨³å®šæ€§ã€å®‰å…¨æ€§ï¼Œå¹¶æ”¯æŒæ›´å¤šå¤§æ¨¡å‹ã€‚

1.6.2 å†…éƒ¨æ¶æ„è¯¦æƒ…



ç»“æ„
è¯´æ˜




LangChain
æ ¸å¿ƒæ¡†æ¶ï¼ŒåŒ…å« langchain, langchain-core, langchain-communityã€‚æä¾› Chains, Agents, Retrieval strategies ç­‰ï¼Œæ˜¯ AI åº”ç”¨çš„â€œç»„è£…å¥—ä»¶â€ã€‚


LangGraph
åŸºäº LangChain API çš„è¿›ä¸€æ­¥å°è£…ï¼Œç”¨äºåè°ƒå¤šä¸ª Chainã€Agentã€Tools å®Œæˆæ›´å¤æ‚çš„ä»»åŠ¡ã€‚


LangSmith
https://docs.smith.langchain.com/ï¼Œæä¾› Debuggingã€Playgroundã€Prompt Managementã€Testingã€Monitoring ç­‰åŠŸèƒ½ï¼Œå¸®åŠ©ä»åŸå‹èµ°å‘ç”Ÿäº§ã€‚


LangServe
å°† LangChain åº”ç”¨æ‰“åŒ…æˆ REST APIï¼Œä¾¿äºéƒ¨ç½²å’Œè°ƒç”¨ï¼ˆå¦‚ Java ç¨‹åºè°ƒç”¨ï¼‰ã€‚




ğŸš€ æœ€æœ‰å‰é€”çš„ä¸¤ä¸ªæ¨¡å—ï¼šLangGraphï¼ˆå‘åŠ› Agent å¤æ‚ä»»åŠ¡ï¼‰å’Œ LangSmithï¼ˆè¿ç»´ä¸ç›‘æ§ï¼‰ã€‚


2. å¼€å‘å‰çš„å‡†å¤‡å·¥ä½œ
2.1 å‰ç½®çŸ¥è¯†

Python åŸºç¡€è¯­æ³•ï¼šå˜é‡ã€å‡½æ•°ã€ç±»ã€è£…é¥°å™¨ã€ä¸Šä¸‹æ–‡ç®¡ç†å™¨ã€‚
åŒ…ç®¡ç†ï¼šç†Ÿæ‚‰ pip æˆ– condaã€‚
å¤§è¯­è¨€æ¨¡å‹åŸºç¡€ï¼šäº†è§£ LLMã€Tokenã€Promptã€Embedding çš„æ¦‚å¿µã€‚
API ä½¿ç”¨ç»éªŒï¼šä½¿ç”¨è¿‡ OpenAIã€Anthropicã€DeepSeek ç­‰æ¨¡å‹çš„ APIã€‚

2.2 ç›¸å…³ç¯å¢ƒå®‰è£…


å®‰è£… Python æˆ– Anaconda

æ¨èç‰ˆæœ¬ï¼šPython 3.10 åŠä»¥ä¸Šã€‚
Python å®˜ç½‘ï¼šhttps://www.python.org/



åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èä½¿ç”¨ condaï¼‰

ä¿æŒé¡¹ç›®ç‹¬ç«‹ï¼Œé¿å…ä¾èµ–å†²çªã€‚



å®‰è£… LangChain åŒ…
# ä½¿ç”¨ pip
pip install langchain
# æŒ‡å®šç‰ˆæœ¬
pip install langchain==0.3.7
# å›½å†…é•œåƒåŠ é€Ÿ
pip install -i https://mirrors.aliyun.com/pypi/simple/ langchain

# ä½¿ç”¨ conda
conda install -c conda-forge langchain==0.3.7


å»ºè®®ï¼šå…ˆç”¨ conda è£…åŸºç¡€åŒ…ï¼Œå†ç”¨ pip è¡¥å……ã€‚



å¼€å‘ç¯å¢ƒï¼šæ¨èä½¿ç”¨ PyCharmã€‚



3. å¤§æ¨¡å‹åº”ç”¨å¼€å‘
3.1 åŸºäº RAG æ¶æ„çš„å¼€å‘

èƒŒæ™¯ï¼šè§£å†³å¤§æ¨¡å‹çš„çŸ¥è¯†å†»ç»“å’Œå¹»è§‰é—®é¢˜ã€‚
ç±»æ¯”ï¼šå­¦ç”Ÿè€ƒè¯•æ—¶ï¼ŒRAG å°±åƒä¸€ä»½â€œå‚è€ƒèµ„æ–™â€ï¼Œèƒ½å°†æ­£ç¡®ç‡ä» 60% æå‡åˆ° 90%ã€‚

ä»€ä¹ˆæ˜¯ RAGï¼Ÿ
Retrieval-Augmented Generation (æ£€ç´¢å¢å¼ºç”Ÿæˆ)

æ£€ç´¢ (Retrieval)ï¼šä»å¤–éƒ¨çŸ¥è¯†åº“ä¸­æŸ¥æ‰¾ç›¸å…³ä¿¡æ¯ã€‚
å¢å¼º (Augment)ï¼šå°†æ£€ç´¢åˆ°çš„ä¿¡æ¯ä½œä¸ºä¸Šä¸‹æ–‡æ³¨å…¥åˆ° Prompt ä¸­ã€‚
ç”Ÿæˆ (Generation)ï¼šå¤§æ¨¡å‹åŸºäºå¢å¼ºåçš„ Prompt ç”Ÿæˆæœ€ç»ˆå›ç­”ã€‚

RAG æµç¨‹è¯¦è§£
graph LR
    A[æœ¬åœ°æ–‡ä»¶ PDF/Word/TXT] --> B[Unstructured Loader]
    B --> C[Text Splitter]
    C --> D[Text Chunk]
    D --> E[Embedding Model]
    E --> F[Vector Embeddings]
    F --> G[Vector Database]
    H[ç”¨æˆ· Query] --> I[Embedding Model]
    I --> J[Vector Embeddings]
    J --> K[Similarity Search]
    K --> L[Context from Vector DB]
    M[Prompt Template] --> N[Prompt = Context + User Query]
    L --> N
    N --> O[LLM]
    O --> P[Answer]



éš¾ç‚¹æ­¥éª¤ï¼š

æ–‡ä»¶è§£æ
æ–‡ä»¶åˆ‡å‰²
çŸ¥è¯†æ£€ç´¢
çŸ¥è¯†é‡æ’åº (Reranker)



Reranker ä½¿ç”¨åœºæ™¯ï¼š

é€‚åˆï¼šè¿½æ±‚å›ç­”é«˜ç²¾åº¦å’Œé«˜ç›¸å…³æ€§çš„åœºæ™¯ï¼ˆå¦‚ä¸“ä¸šçŸ¥è¯†åº“ã€å®¢æœç³»ç»Ÿï¼‰ã€‚
ä¸é€‚åˆï¼šå¯¹å“åº”æ—¶é—´è¦æ±‚æé«˜çš„åœºæ™¯ï¼ˆä¼šå¢åŠ å»¶è¿Ÿï¼‰ã€‚



æ¶‰åŠçš„å¤§æ¨¡å‹ï¼š

ç¬¬3æ­¥ï¼ˆå‘é‡åŒ–ï¼‰ï¼šEmbedding Models
ç¬¬7æ­¥ï¼ˆé‡æ’åºï¼‰ï¼šRerank Models
ç¬¬9æ­¥ï¼ˆç”Ÿæˆç­”æ¡ˆï¼‰ï¼šLLM



3.2 åŸºäº Agent æ¶æ„çš„å¼€å‘


æ ¸å¿ƒæ€æƒ³ï¼šèµ‹äºˆ LLM è§„åˆ’ (Planning)ã€è®°å¿† (Memory)ã€å·¥å…·è°ƒç”¨ (Tools) çš„èƒ½åŠ›ï¼Œä½¿å…¶æˆä¸ºä¸€ä¸ªèƒ½ç‹¬ç«‹æ€è€ƒã€è‡ªä¸»å®Œæˆç›®æ ‡çš„æ™ºèƒ½ä½“ã€‚


Agent å…¬å¼ï¼šAgent = LLM + Memory + Tools + Planning + Action


æ™ºèƒ½ä½“æ ¸å¿ƒè¦ç´ 


å¤§æ¨¡å‹ (LLM) - â€œå¤§è„‘â€

ä½œä¸ºå†³ç­–ä¸­æ¢ï¼Œæä¾›æ¨ç†ã€è§„åˆ’å’ŒçŸ¥è¯†ç†è§£èƒ½åŠ›ã€‚



è®°å¿† (Memory)

çŸ­æœŸè®°å¿†ï¼šå­˜å‚¨å•æ¬¡å¯¹è¯çš„ä¸Šä¸‹æ–‡ã€‚å—é™äºæ¨¡å‹çš„ä¸Šä¸‹æ–‡çª—å£ï¼ˆå¦‚ GPT-4 æ”¯æŒ 32k tokensï¼‰ã€‚
é•¿æœŸè®°å¿†ï¼šæ¨ªè·¨å¤šä¸ªä»»åŠ¡ï¼Œå¯é€šè¿‡å‘é‡æ•°æ®åº“ï¼ˆç›¸ä¼¼æ€§æ£€ç´¢ï¼‰æˆ–çŸ¥è¯†å›¾è°±å®ç°ã€‚



å·¥å…·ä½¿ç”¨ (Tool Use)

è°ƒç”¨å¤–éƒ¨ APIï¼ˆå¦‚å¤©æ°”æŸ¥è¯¢ã€Google æœç´¢ã€æ•°æ®åº“ï¼‰æ¥æ‰©å±•èƒ½åŠ›è¾¹ç•Œã€‚



è§„åˆ’å†³ç­– (Planning)

å°†å¤æ‚ç›®æ ‡åˆ†è§£ä¸ºå­ä»»åŠ¡ï¼ˆå¦‚ä½¿ç”¨æ€ç»´é“¾ Chain of Thoughtï¼‰ï¼Œå¹¶é€šè¿‡åæ€ä¼˜åŒ–ç­–ç•¥ã€‚



è¡ŒåŠ¨ (Action)

å®é™…æ‰§è¡Œå†³ç­–ï¼Œå¦‚è‡ªåŠ¨è®¢ç¥¨ã€ç”Ÿæˆä»£ç ç­‰ã€‚



3.3 å¤§æ¨¡å‹åº”ç”¨å¼€å‘çš„4ä¸ªåœºæ™¯



åœºæ™¯
æè¿°
ç±»æ¯”




1. çº¯ Prompt
é€šè¿‡ç²¾å¿ƒè®¾è®¡çš„ Prompt æ¥æ“æ§æ¨¡å‹ã€‚
ä½ è¯´ä¸€å¥ï¼Œå®ƒå›ä¸€å¥ã€‚


2. Agent + Function Calling
AI ä¸»åŠ¨æå‡ºéœ€æ±‚ï¼Œå¹¶è°ƒç”¨å¤–éƒ¨å‡½æ•°ã€‚
ä½ é—®â€œæ˜å¤©å»æ­å·è¦å¸¦ä¼å—ï¼Ÿâ€ï¼ŒAI ä¼šå…ˆè¦æ±‚â€œè¯·å‘Šè¯‰æˆ‘æ­å·çš„å¤©æ°”â€ã€‚


3. RAG (æ£€ç´¢å¢å¼ºç”Ÿæˆ)
åœ¨å›ç­”å‰ï¼Œä»å¤–éƒ¨çŸ¥è¯†åº“æ£€ç´¢ç›¸å…³ä¿¡æ¯ã€‚
è€ƒè¯•æ—¶ç¿»ä¹¦æ‰¾ç­”æ¡ˆã€‚


4. Fine-tuning (å¾®è°ƒ)
ç”¨ç‰¹å®šæ•°æ®é›†è®­ç»ƒæ¨¡å‹ï¼Œä½¿å…¶é•¿æœŸæŒæ¡æŸé¡¹æŠ€èƒ½ã€‚
é•¿æœŸåŠªåŠ›å­¦ä¹ å¤‡è€ƒã€‚




âš ï¸ æˆæœ¬æ’åºï¼šFine-tuning >> RAG > Agent > Promptã€‚é€šå¸¸ä¼˜å…ˆè€ƒè™‘ä½æˆæœ¬æ–¹æ¡ˆã€‚


4. LangChain çš„æ ¸å¿ƒç»„ä»¶
4.1 ä¸€ä¸ªé—®é¢˜å¼•å‘çš„æ€è€ƒ
è¦ç»„ç»‡ä¸€ä¸ª AI åº”ç”¨ï¼Œå¼€å‘è€…é€šå¸¸éœ€è¦ï¼š

æ„å»ºæç¤ºè¯æ¨¡æ¿ï¼ˆPrompt Templateï¼‰ã€‚
è°ƒç”¨æ¨¡å‹å¹¶æ ¼å¼åŒ–è¿”å›ç»“æœã€‚
æŸ¥è¯¢çŸ¥è¯†åº“ï¼ˆæ–‡æ¡£åŠ è½½ã€åˆ‡å‰²ã€å‘é‡åŒ–ï¼‰ã€‚
è°ƒç”¨ç¬¬ä¸‰æ–¹å·¥å…·ï¼ˆå¤©æ°”ã€æœç´¢ï¼‰ã€‚
ç®¡ç†å¯¹è¯è®°å¿†ï¼ˆè·å–ä¸Šä¸‹æ–‡ï¼‰ã€‚

4.2 æ ¸å¿ƒç»„ä»¶æ¦‚è¿°
LangChain æä¾›äº†å…­å¤§æ ¸å¿ƒæ¨¡å—ï¼Œæ„å»ºå¼ºå¤§åº”ç”¨çš„åŸºçŸ³ã€‚
4.3 æ ¸å¿ƒç»„ä»¶è¯´æ˜



ç»„ä»¶
è¯´æ˜




1. Model I/O
æœ€å¸¸ç”¨ã€æœ€ç®€å•ã€‚æ ‡å‡†åŒ–å¤§æ¨¡å‹çš„è¾“å…¥ï¼ˆPromptï¼‰å’Œè¾“å‡ºï¼ˆResponseï¼‰ã€‚åŒ…å« Format (æç¤ºè¯), Predict (æ¨¡å‹), Parse (è¾“å‡ºè§£æ) ä¸‰éƒ¨åˆ†ã€‚


2. Chains
æœ€é‡è¦çš„æ¨¡å—ã€‚â€œé“¾æ¡â€å°†å¤šä¸ªç»„ä»¶ä¸²è”æˆå®Œæ•´æµç¨‹ã€‚å¸¸è§ç±»å‹ï¼š<br>- LLMChainï¼šåŸºç¡€è°ƒç”¨é“¾<br>- SequentialChainï¼šå¤šé“¾ä¸²è”<br>- RouterChainï¼šè·¯ç”±åˆ°æœ€é€‚åˆçš„é“¾<br>- RetrievalQAï¼šç»“åˆå‘é‡åº“çš„é—®ç­”é“¾


3. Memory
ç®¡ç†å¯¹è¯å†å²å’Œä¸Šä¸‹æ–‡ã€‚<br>- ConversationBufferMemoryï¼šä¿å­˜å®Œæ•´å†å²<br>- ConversationSummaryMemoryï¼šä¿å­˜å¯¹è¯æ‘˜è¦<br>- VectorStoreRetrieverMemoryï¼šå†å²å­˜äºå‘é‡åº“


4. Agents
é«˜é˜¶èƒ½åŠ›ã€‚æ™ºèƒ½ä½“èƒ½è‡ªä¸»é€‰æ‹©å·¥å…·ã€è§„åˆ’æ­¥éª¤ã€‚åŒ…å« AgentType, Tool, AgentExecutorã€‚


5. Retrieval
å¯¹åº” RAGã€‚è´Ÿè´£ä»å¤–éƒ¨æ•°æ®æºï¼ˆè§†é¢‘ã€å›¾ç‰‡ã€æ–‡æœ¬ï¼‰åŠ è½½ã€è½¬æ¢ã€åµŒå…¥ã€å­˜å‚¨å’Œæ£€ç´¢ä¿¡æ¯ã€‚


6. Callbacks
å›è°ƒæœºåˆ¶ï¼Œç”¨äºç›‘æ§å’Œåˆ†æåº”ç”¨è¿è¡Œï¼ˆå¦‚æ—¥å¿—è®°å½•ã€æ€§èƒ½ç›‘æ§ã€æµå¼ä¼ è¾“ï¼‰ã€‚



4.4 å°ç»“

Model I/Oï¼šä½¿ç”¨æœ€å¤šã€‚
Chainsï¼šæœ€é‡è¦ã€‚
Retrieval å’Œ Agentsï¼šå¤§æ¨¡å‹åº”ç”¨æœ€ä¸»è¦çš„è½åœ°åœºæ™¯ã€‚


5. LangChain çš„ Hello World
5.1 è·å–å¤§æ¨¡å‹
import dotenv
from langchain_openai import ChatOpenAI
import os

# åŠ è½½ .env æ–‡ä»¶ä¸­çš„ç¯å¢ƒå˜é‡
dotenv.load_dotenv()
os.environ['OPENAI_API_KEY'] = os.getenv("OPENAI_API_KEY1")
os.environ['OPENAI_BASE_URL'] = os.getenv("OPENAI_BASE_URL")

# åˆ›å»ºå¤§æ¨¡å‹å®ä¾‹
llm = ChatOpenAI(model="gpt-4o-mini")

# è°ƒç”¨æ¨¡å‹
response = llm.invoke("ä»€ä¹ˆæ˜¯å¤§æ¨¡å‹ï¼Ÿ")
print(response)

5.2 ä½¿ç”¨æç¤ºè¯æ¨¡æ¿
from langchain_core.prompts import ChatPromptTemplate

# åˆ›å»ºåŒ…å«å˜é‡çš„æç¤ºè¯æ¨¡æ¿
prompt = ChatPromptTemplate.from_messages([
    ("system", "ä½ æ˜¯ä¸–ç•Œçº§çš„æŠ€æœ¯æ–‡æ¡£ç¼–å†™è€…"),
    ("user", "{input}")
])

# ç»„åˆé“¾
chain = prompt | llm
message = chain.invoke({"input": "å¤§æ¨¡å‹ä¸­çš„LangChainæ˜¯ä»€ä¹ˆ?"})
print(message)

5.3 ä½¿ç”¨è¾“å‡ºè§£æå™¨
from langchain_core.output_parsers import JsonOutputParser

# åˆå§‹åŒ–æ¨¡å‹å’Œæ¨¡æ¿
llm = ChatOpenAI(model="gpt-4o-mini")
prompt = ChatPromptTemplate.from_messages([
    ("system", "ä½ æ˜¯ä¸–ç•Œçº§çš„æŠ€æœ¯æ–‡æ¡£ç¼–å†™è€…ã€‚è¾“å‡ºæ ¼å¼è¦æ±‚ï¼š{format_instructions}"),
    ("user", "{input}")
])

# ä½¿ç”¨ JSON è¾“å‡ºè§£æå™¨
output_parser = JsonOutputParser()
chain = prompt | llm | output_parser

# è°ƒç”¨
result = chain.invoke({
    "input": "LangChainæ˜¯ä»€ä¹ˆ?",
    "format_instructions": output_parser.get_format_instructions()
})
print(result)

5.4 ä½¿ç”¨å‘é‡å­˜å‚¨ (FAISS)
pip install faiss-cpu
pip install langchain_community==0.3.7

from langchain_community.document_loaders import WebBaseLoader
import bs4

# åŠ è½½ç½‘é¡µå†…å®¹
loader = WebBaseLoader(
    web_path="https://www.gov.cn/xinwen/2020-06/01/content_5516649.htm",
    bs_kwargs=dict(parse_only=bs4.SoupStrainer(id="UCAP-CONTENT"))
)
docs = loader.load()

from langchain_text_splitters import RecursiveCharacterTextSplitter
from langchain_openai import OpenAIEmbeddings
from langchain_community.vectorstores import FAISS

# æ–‡æœ¬åˆ‡å‰²
text_splitter = RecursiveCharacterTextSplitter(chunk_size=500, chunk_overlap=50)
documents = text_splitter.split_documents(docs)

# å‘é‡åŒ–å¹¶å­˜å…¥ FAISS
embeddings = OpenAIEmbeddings(model="text-embedding-ada-002")
vector = FAISS.from_documents(documents, embeddings)

5.5 RAG (æ£€ç´¢å¢å¼ºç”Ÿæˆ)
# ä»å‘é‡åº“æ£€ç´¢
retriever = vector.as_retriever()
retriever.search_kwargs = {"k": 3}
docs = retriever.invoke("å»ºè®¾ç”¨åœ°ä½¿ç”¨æƒæ˜¯ä»€ä¹ˆï¼Ÿ")

# å®šä¹‰ RAG æç¤ºè¯æ¨¡æ¿
prompt_template = """
ä½ æ˜¯ä¸€ä¸ªé—®ç­”æœºå™¨äººã€‚ä½ çš„ä»»åŠ¡æ˜¯æ ¹æ®ä¸‹è¿°ç»™å®šçš„å·²çŸ¥ä¿¡æ¯å›ç­”ç”¨æˆ·é—®é¢˜ã€‚
ç¡®ä¿ä½ çš„å›å¤å®Œå…¨ä¾æ®ä¸‹è¿°å·²çŸ¥ä¿¡æ¯ã€‚ä¸è¦ç¼–é€ ç­”æ¡ˆã€‚
å¦‚æœä¸‹è¿°å·²çŸ¥ä¿¡æ¯ä¸è¶³ä»¥å›ç­”ç”¨æˆ·çš„é—®é¢˜ï¼Œè¯·ç›´æ¥å›å¤"æˆ‘æ— æ³•å›ç­”æ‚¨çš„é—®é¢˜"ã€‚

å·²çŸ¥ä¿¡æ¯:
{info}

ç”¨æˆ·é—®ï¼š
{question}

è¯·ç”¨ä¸­æ–‡å›ç­”ç”¨æˆ·é—®é¢˜ã€‚
"""

from langchain_core.prompts import PromptTemplate
template = PromptTemplate.from_template(prompt_template)
prompt = template.format(info=docs, question='å»ºè®¾ç”¨åœ°ä½¿ç”¨æƒæ˜¯ä»€ä¹ˆï¼Ÿ')

# è°ƒç”¨ LLM
response = llm.invoke(prompt)
print(response.content)

5.6 ä½¿ç”¨ Agent
from langchain.tools.retriever import create_retriever_tool

# åˆ›å»ºæ£€ç´¢å™¨å·¥å…·
retriever_tool = create_retriever_tool(
    retriever,
    "CivilCodeRetriever",
    "æœç´¢æœ‰å…³ä¸­åäººæ°‘å…±å’Œå›½æ°‘æ³•å…¸çš„ä¿¡æ¯ã€‚å…³äºä¸­åäººæ°‘å…±å’Œå›½æ°‘æ³•å…¸çš„ä»»ä½•é—®é¢˜ï¼Œæ‚¨å¿…é¡»ä½¿ç”¨æ­¤å·¥å…·!"
)
tools = [retriever_tool]

from langchain.agents import create_openai_functions_agent, AgentExecutor
from langchain import hub

# æ‹‰å–é¢„è®¾çš„ Agent Prompt
prompt = hub.pull("hwchase17/openai-functions-agent")
agent = create_openai_functions_agent(llm, tools, prompt)
agent_executor = AgentExecutor(agent=agent, tools=tools, verbose=True)

# è¿è¡Œ Agent
agent_executor.invoke({"input": "å»ºè®¾ç”¨åœ°ä½¿ç”¨æƒæ˜¯ä»€ä¹ˆ"})

